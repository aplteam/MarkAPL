 R←Test_Lamp_003(stopFlag batchFlag);⎕TRAP;md;ns
⍝ Test whether a line that starts with a lamp WITHIN CODE survives (was once a bug)
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 R←∆Failed

 md←''
 md,←⊂'Para 1'
 md,←⊂''
 md,←⊂'~~~'
 md,←⊂'⍝ Should make it into the output'
 md,←⊂'~~~'
 md,←⊂''
 md,←⊂'````'
 md,←⊂'⍝ Should also make it into the output'
 md,←⊂'````'
 md,←⊂''
 md,←⊂'⍝ Should **not** make it into the output'
 md,←⊂''
 md,←⊂'Para 2'

 ns←##.MarkAPL.Init''md
 ns←##.MarkAPL.Process ns

 →PassesIf'<p>Para 1</p>'≡0⊃ns.html
 →PassesIf'<pre><code>⍝ Should make it into the output</code></pre>'≡1⊃ns.html
 →PassesIf'<pre><code>⍝ Should also make it into the output</code></pre>'≡2⊃ns.html
 →PassesIf'<p>Para 2</p>'≡3⊃ns.html
 →PassesIf 4=⍴ns.html

 R←∆OK
